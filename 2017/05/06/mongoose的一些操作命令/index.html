<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>mongoose的一些操作命令 | 咸鱼老弟</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">mongoose的一些操作命令</h1><a id="logo" href="/.">咸鱼老弟</a><p class="description">【博客园-咸鱼老弟】</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/resource/"><i class="fa fa-university"> 资源</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">mongoose的一些操作命令</h1><div class="post-meta">May 6, 2017<span> | </span><span class="category"><a href="/categories/node/">node</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Schema"><span class="toc-number">1.</span> <span class="toc-text">1.Schema</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Model模型"><span class="toc-number">2.</span> <span class="toc-text">2. Model模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-model-文档操作"><span class="toc-number">3.</span> <span class="toc-text">3. model - 文档操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-Entity-文档操作"><span class="toc-number">4.</span> <span class="toc-text">4. Entity - 文档操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-修改器和更新器"><span class="toc-number">5.</span> <span class="toc-text">5. 修改器和更新器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-其他"><span class="toc-number">6.</span> <span class="toc-text">6.其他</span></a></li></ol></div></div><div class="post-content"><p>&ensp;&ensp;&ensp;&ensp;最近在用express+mongoose写一个网站，因为经常要用到mongoose的一些操作命令，经常去查还挺麻烦的，所以总结一篇mongoose的使用以及一些操作命令。mongoose里面有三个概念，schemal、model、entity。先来对其三者做个小小的总结概括。<br><code>Schema</code> ： 一种以文件形式存储的数据库模型骨架，不具备数据库的操作能力<br><code>Model</code> ： 由Schema发布生成的模型，具有抽象属性和行为的数据库操作对<br><code>Entity</code> ： 由Model创建的实体，他的操作也会影响数据库<br><a id="more"></a><br>&ensp;&ensp;&ensp;&ensp;Schema、Model、Entity的关系请牢记，Schema生成Model，Model创造Entity，Model和Entity都可对数据库操作造成影响，但Model比Entity更具操作性。<br>&ensp;&ensp;&ensp;&ensp;你可以使用Model来创建Entity，Entity实体是一个特有Model具体对象，但是他并不具备Model的方法，只能用自己的方法。</p>
<h2 id="1-Schema"><a href="#1-Schema" class="headerlink" title="1.Schema"></a>1.Schema</h2><p>schema是mongoose里会用到的一种数据模式，可以理解为表结构的定义；<br>每个schema会映射到mongodb中的一个collection，它不具备操作数据库的能力.<br>仅仅只是一段代码，无法通往数据库端, 仅仅只是数据库模型在程序片段中的一种表现</p>
<p>定义Schema<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">'./db.js'</span>),</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> UserSchema = <span class="keyword">new</span> mongoose.Schema(&#123;          </span><br><span class="line">    username : &#123; <span class="attr">type</span>: <span class="built_in">String</span> &#125;,                    </span><br><span class="line">    userpwd: &#123;<span class="attr">type</span>: <span class="built_in">String</span>&#125;,                        </span><br><span class="line">    userage: &#123;<span class="attr">type</span>: <span class="built_in">Number</span>&#125;,                       </span><br><span class="line">    logindate : &#123; <span class="attr">type</span>: <span class="built_in">Date</span>&#125;                      </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p><strong> Schema Types的内置类型 </strong></p>
<ul>
<li><code>String</code></li>
<li><code>Number</code></li>
<li><code>Boolean | Bool</code></li>
<li><code>Array</code></li>
<li><code>Buffer</code></li>
<li><code>Date</code></li>
<li><code>ObjectId | Oid</code></li>
<li><code>Mixed</code></li>
</ul>
<h2 id="2-Model模型"><a href="#2-Model模型" class="headerlink" title="2. Model模型"></a>2. Model模型</h2><p>Model模型，是经过Schema构造来的，是Schema的编译版本。一个model的实例直接映射为数据库中的一个文档。基于这种关系， 以后的增删改查（CURD）都要通过这个Model实现。</p>
<p>下面我们来定义我们的model<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">'./db.js'</span>);</span><br><span class="line"><span class="keyword">var</span> ObjectId = mongoose.Schema.ObjectId;</span><br><span class="line"><span class="keyword">var</span> UserSchema = <span class="keyword">new</span> mongoose.Schema(&#123;          </span><br><span class="line">    name : &#123; <span class="attr">type</span>: <span class="built_in">String</span> &#125;,                                       </span><br><span class="line">    age: &#123;<span class="attr">type</span>: <span class="built_in">Number</span>&#125;,   </span><br><span class="line">    updated:&#123;<span class="attr">type</span>:<span class="keyword">new</span> <span class="built_in">Date</span>&#125;,                  </span><br><span class="line">    binary:&#123; <span class="attr">type</span>:Buffer &#125;,</span><br><span class="line">    _id : &#123; <span class="attr">type</span>:ObjectId &#125;,</span><br><span class="line">    mixed : &#123; <span class="attr">type</span>: Mixed &#125;,    </span><br><span class="line">    isMerried :&#123; <span class="attr">type</span> : <span class="built_in">Boolean</span> &#125;                                      </span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">module</span>.exports = mongoose.model(<span class="string">'User'</span>,UserSchema);</span><br></pre></td></tr></table></figure></p>
<p>定义好model之后，就可以往里面进行一些增删查改的操作了。</p>
<h2 id="3-model-文档操作"><a href="#3-model-文档操作" class="headerlink" title="3. model - 文档操作"></a>3. model - 文档操作</h2><p><strong> 增加数据 </strong><br>如果是Entity，使用save方法，如果是Model，使用create方法<br><code>Model.create(data, callback))</code><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">User.create(data,<span class="function"><span class="keyword">function</span>(<span class="params">err, doc</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="built_in">console</span>.log(err);</span><br><span class="line">      <span class="built_in">console</span>.log(doc);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure></p>
<p><strong> 查询 </strong><br><code>model.find({}, callback)</code>; 参数1忽略,或为空对象则返回所有集合文档<br><code>model.find({},field,callback)</code>;  过滤查询,参数2: {‘name’:1, ‘age’:0} 查询文档的返回结果包含name , field的值中,1为包括，0为不包括<br><code>model.find({},null,{limit:20})</code>; 过滤查询,参数3: 游标操作 limit限制返回结果数量为20个,如不足20个则返回所有.<br><code>model.findOne({}, callback)</code>; 查询找到的第一个文档<br><code>model.findById(&#39;obj._i&#39;, callback)</code>; 查询找到的第一个文档,同上. 但是只接 <code>_id</code> 的值查询<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//find</span></span><br><span class="line">User.find(&#123;&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(err);</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//findOne</span></span><br><span class="line">User.findOne(&#123;<span class="attr">name</span>: <span class="string">'张三'</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(err);</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//findByID 与 findOne 相同，但它接收文档的 _id 作为参数，返回单个文档。_id //可以是字符串或 ObjectId 对象。</span></span><br><span class="line">User.findById(id, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) consoel.log(err);</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p><strong> 更新 </strong><br><code>Model.update(conditions, data, [options], [callback])</code><br>conditions 更新条件<br>data 更新内容<br>option 更新选项<br>&ensp;&ensp;<code>safe (boolean)</code> 安全模式，默认选项，值为true<br>&ensp;&ensp;<code>upsert (boolean</code>) 条件不匹配时是否创建新文档，默认值为false<br>&ensp;&ensp;<code>multi (boolean)</code> 是否更新多个文件，默认值为false<br>&ensp;&ensp;<code>strict (boolean)</code> 严格模式，只更新一条数据<br>&ensp;&ensp;<code>overwrite (boolean)</code> 覆盖数据，默认为false<br>callback回调<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">User.update(&#123;<span class="attr">name</span>: <span class="string">'张三'</span>&#125;, &#123;<span class="attr">age</span>: <span class="string">'6'</span>&#125;, &#123;<span class="attr">multi</span> : <span class="literal">true</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, numberAffected, raw</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="built_in">console</span>.log(err);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p><strong> 删除 </strong><br><code>Model.remove(conditions,callback);</code><br>参数1:查询条件<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">User.remove(&#123;<span class="attr">age</span>: <span class="number">6</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<h2 id="4-Entity-文档操作"><a href="#4-Entity-文档操作" class="headerlink" title="4. Entity - 文档操作"></a>4. Entity - 文档操作</h2><p>由Model创建的实体，使用save方法保存数据，Model和Entity都有能影响数据库的操作，但Model比Entity更具操作性<br>创建<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用Entity来增加一条数据</span></span><br><span class="line"><span class="keyword">var</span> krouky = <span class="keyword">new</span> PersonModel(&#123;<span class="attr">name</span>:<span class="string">'krouky'</span>&#125;);</span><br><span class="line">krouky.save(callback);</span><br><span class="line"><span class="comment">//对比使用Model来增加一条数据</span></span><br><span class="line"><span class="keyword">var</span> MDragon = &#123;<span class="attr">name</span>:<span class="string">'MDragon'</span>&#125;;</span><br><span class="line">PersonModel.create(MDragon,callback);</span><br></pre></td></tr></table></figure></p>
<h2 id="5-修改器和更新器"><a href="#5-修改器和更新器" class="headerlink" title="5. 修改器和更新器"></a>5. 修改器和更新器</h2><p><strong> 更新修改器 </strong><br><code>$inc</code> 增减修改器,只对数字有效.下面的实例: 找到 age=22的文档,修改文档的age值自增1<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Model.update(&#123;<span class="string">'age'</span>:<span class="number">22</span>&#125;, &#123;<span class="string">'$inc'</span>:&#123;<span class="string">'age'</span>:<span class="number">1</span>&#125; &#125;  ); <span class="comment">// 执行后: age=23</span></span><br></pre></td></tr></table></figure></p>
<p><code>$set</code> 指定一个键的值,这个键不存在就创建它.可以是任何MondoDB支持的类型.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Model.update(&#123;<span class="string">'age'</span>:<span class="number">22</span>&#125;, &#123;<span class="string">'$set'</span>:&#123;<span class="string">'age'</span>:<span class="string">'haha'</span>&#125; &#125;  ); <span class="comment">// 执行后: age='haha'</span></span><br></pre></td></tr></table></figure></p>
<p><code>$unset</code> 同上取反,删除一个键<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Model.update(&#123;<span class="string">'age'</span>:<span class="number">22</span>&#125;, &#123;<span class="string">'$unset'</span>:&#123;<span class="string">'age'</span>:<span class="string">'haha'</span>&#125; &#125;  ); <span class="comment">//执行后: age键不存在`</span></span><br></pre></td></tr></table></figure></p>
<p><strong> 数组修改器: </strong><br><code>$push</code>给一个键push一个数组成员,键不存在会创建<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Model.update(&#123;<span class="string">'age'</span>:<span class="number">22</span>&#125;, &#123;<span class="string">'$push'</span>:&#123;<span class="string">'array'</span>:<span class="number">10</span>&#125; &#125; ); <span class="comment">//执行后: 增加一个 array 键,类型为数组, 有一个成员 10`</span></span><br></pre></td></tr></table></figure></p>
<p><code>$addToSet</code> 向数组中添加一个元素,如果存在就不添加<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Model.update(&#123;<span class="string">'age'</span>:<span class="number">22</span>&#125;, &#123;<span class="string">'$addToSet'</span>:&#123;<span class="string">'array'</span>:<span class="number">10</span>&#125; &#125; ); <span class="comment">// 执行后: array中有10所以不会添加</span></span><br></pre></td></tr></table></figure></p>
<p><code>$each</code> 遍历数组, 和 $push 修改器配合可以插入多个值<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Model.update(&#123;<span class="string">'age'</span>:<span class="number">22</span>&#125;, &#123;<span class="string">'$push'</span>:&#123;<span class="string">'array'</span>:&#123;<span class="string">'$each'</span>: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]&#125;&#125; &#125; ); <span class="comment">//执行后: array : [10,1,2,3,4,5]</span></span><br></pre></td></tr></table></figure></p>
<p><code>$pop</code> 向数组中尾部删除一个元素<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Model.update(&#123;<span class="string">'age'</span>:<span class="number">22</span>&#125;, &#123;<span class="string">'$pop'</span>:&#123;<span class="string">'array'</span>:<span class="number">1</span>&#125; &#125; ); <span class="comment">//执行后: array : [10,1,2,3,4] tips: 将1改成-1可以删除数组首部元素</span></span><br></pre></td></tr></table></figure></p>
<p><code>$pull</code> 向数组中删除指定元素<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Model.update(&#123;<span class="string">'age'</span>:<span class="number">22</span>&#125;, &#123;<span class="string">'$pull'</span>:&#123;<span class="string">'array'</span>:<span class="number">10</span>&#125; &#125; ); <span class="comment">// 执行后: array : [1,2,3,4] 匹配到array中的10后将其删除</span></span><br></pre></td></tr></table></figure></p>
<p><strong> 条件查询: </strong><br><code>$lt</code>小于<br><code>$lte</code> 小于等于<br><code>$gt</code> 大于<br><code>$gte</code> 大于等于<br><code>$ne</code> 不等于<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Model.find(&#123;<span class="string">'age'</span>:&#123; <span class="string">'$get'</span>:<span class="number">18</span> , <span class="string">'$lte'</span>:<span class="number">30</span> &#125; &#125; ); <span class="comment">//查询 age 大于等于18并小于等于30的文档</span></span><br></pre></td></tr></table></figure></p>
<p><strong> 或查询 OR: </strong><br><code>$in</code>  一个键对应多个值<br><code>$nin</code> 同上取反, 一个键不对应指定值<br><code>$or</code>  多个条件匹配, 可以嵌套 $in 使用<br><code>$not</code> 同上取反, 查询与特定模式不匹配的文档<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Model.find(&#123;<span class="string">'age'</span>:&#123; <span class="string">'$in'</span>:[<span class="number">20</span>,<span class="number">21</span>,<span class="number">22.</span><span class="string">'haha'</span>]&#125; &#125; ); <span class="comment">//查询 age等于20或21或21或'haha'的文档</span></span><br><span class="line">Model.find(&#123;<span class="string">'$or'</span> :  [ &#123;<span class="string">'age'</span>:<span class="number">18</span>&#125; , &#123;<span class="string">'name'</span>:<span class="string">'xueyou'</span>&#125; ] &#125;); <span class="comment">//查询 age等于18 或 name等于'xueyou' 的文档</span></span><br></pre></td></tr></table></figure></p>
<p><strong> 类型查询: </strong><br>null 能匹配自身和不存在的值, 想要匹配键的值 为null, 就要通过  ‘$exists’ 条件判定键值已经存在 “$exists” (表示是否存在的意思)<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Model.find(<span class="string">'age'</span> :  &#123; <span class="string">'$in'</span> : [<span class="literal">null</span>] , <span class="string">'exists'</span> : <span class="literal">true</span>  &#125; ); <span class="comment">// 查询 age值为null的文档</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Model.find(&#123;<span class="attr">name</span>:&#123;<span class="attr">$exists</span>:<span class="literal">true</span>&#125;&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">error,docs</span>)</span>&#123;</span><br><span class="line">  <span class="comment">//查询所有存在name属性的文档</span></span><br><span class="line">&#125;);</span><br><span class="line">Model.find(&#123;<span class="attr">telephone</span>:&#123;<span class="attr">$exists</span>:<span class="literal">false</span>&#125;&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">error,docs</span>)</span>&#123;</span><br><span class="line">  <span class="comment">//查询所有不存在telephone属性的文档</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><strong> 正则表达式: </strong><br>MongoDb 使用 Prel兼容的正则表达式库来匹配正则表达式<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find( &#123;<span class="string">'name'</span> : <span class="regexp">/joe/i</span> &#125; );  <span class="comment">//查询name为 joe 的文档, 并忽略大小写</span></span><br><span class="line">find( &#123;<span class="string">'name'</span> : <span class="regexp">/joe?/i</span> &#125; ); <span class="comment">//查询匹配各种大小写组合</span></span><br></pre></td></tr></table></figure></p>
<p><strong> 查询数组: </strong><br><code>Model.find({&#39;array&#39;:10} )</code>; 查询 array(数组类型)键中有10的文档, array : [1,2,3,4,5,10] 会匹配到<br><code>Model.find({&#39;array[5]&#39;:10} )</code>; 查询 array(数组类型)键中下标5对应的值是10, array : [1,2,3,4,5,10] 会匹配到<br><code>$all</code> 匹配数组中多个元素<br><code>Model.find({&#39;array&#39;:[5,10]} )</code>; 查询 匹配array数组中 既有5又有10的文档<br><code>$size</code> 匹配数组长度<br><code>Model.find({&#39;array&#39;:{&quot;$size&quot; : 3} } )</code>; 查询 匹配array数组长度为3 的文档<br><code>$slice</code> 查询子集合返回<br><code>Model.find({&#39;array&#39;:{&quot;$skice&quot; : 10} } )</code>; 查询 匹配array数组的前10个元素<br><code>Model.find({&#39;array&#39;:{&quot;$skice&quot; : [5,10] } } )</code>; 查询 匹配array数组的第5个到第10个元素</p>
<p><strong> where </strong><br>用它可以执行任意javacript语句作为查询的一部分,如果回调函数返回 true 文档就作为结果的一部分返回<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//where</span></span><br><span class="line"><span class="comment">//查询数据类型是字符串时，可支持正则</span></span><br><span class="line">User.where(<span class="string">'age'</span>, <span class="string">'2'</span>).exec(<span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(err);</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">User</span><br><span class="line">    .where(<span class="string">'age'</span>).gte(<span class="number">1</span>).lte(<span class="number">10</span>)</span><br><span class="line">    .where(<span class="string">'name'</span>, <span class="string">'张三'</span>)</span><br><span class="line">    .exec(<span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(err);</span><br><span class="line">      <span class="built_in">console</span>.log(data);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure></p>
<p><strong> 游标: </strong><br><code>limit(3)</code> 限制返回结果的数量,<br><code>skip(3)</code> 跳过前3个文档,返回其余的<br><code>sort( {&#39;username&#39;:1 , &#39;age&#39;:-1 } )</code> 排序 键对应文档的键名, 值代表排序方向, 1 升序, -1降序</p>
<h2 id="6-其他"><a href="#6-其他" class="headerlink" title="6.其他"></a>6.其他</h2><p><strong> 数量查询 </strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// //返回数量</span></span><br><span class="line">User.count(&#123;<span class="attr">age</span>: <span class="number">2</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(err);</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p><strong> 分页查询 </strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> User = <span class="built_in">require</span>(<span class="string">"./user.js"</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getByPager</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> pageSize = <span class="number">5</span>;                   <span class="comment">//一页多少条</span></span><br><span class="line">    <span class="keyword">var</span> currentPage = <span class="number">1</span>;                <span class="comment">//当前第几页</span></span><br><span class="line">    <span class="keyword">var</span> sort = &#123;<span class="string">'logindate'</span>:<span class="number">-1</span>&#125;;        <span class="comment">//排序（按登录时间倒序）</span></span><br><span class="line">    <span class="keyword">var</span> condition = &#123;&#125;;                 <span class="comment">//条件</span></span><br><span class="line">    <span class="keyword">var</span> skipnum = (currentPage - <span class="number">1</span>) * pageSize;   <span class="comment">//跳过数</span></span><br><span class="line">    User.find(condition).skip(skipnum).limit(pageSize).sort(sort).exec(<span class="function"><span class="keyword">function</span> (<span class="params">err, res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"Error:"</span> + err);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"Res:"</span> + res);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">getByPager();</span><br></pre></td></tr></table></figure></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="https://xianyulaodi.github.io/2017/05/06/mongoose的一些操作命令/" data-id="cje8p101s000pjkp6quu91ary" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACt0lEQVR42u3aS27DMAwFwNz/0inQbWrlkZScFBivgnxsDQuILMXHI76ev9fV69crv9vrfa7eT+7cvPDw8PBaS18v9OrB63fWgN4d8jXj4eHhneblySBJCeul5Fv/+p5JysHDw8P7LK8K7hXoSdrAw8PD+y+8vHGQlMi9BIOHh4f3PbzkMcmnSQjW35m0j/Hw8PDu4c0PwO5/fev5Hh4eHl6cEqrJoNrATQrxPBn88Sw8PDy8A7y8tO2NAlTfT0JTbnng4eHhbeXlrdg8BPOGRZ4w3gQODw8P7zCvupTqtj4p2asN5fIJHh4eHl7M6yWD8gYdLCspwavfwcPDwzvBmyy0Wkzn7Y/kPlGBjoeHh3eMt358oXiN8dXA5enq8nwPDw8PbxOv12ioPjLf1ufraZ7U4eHh4W3lTQYCkmX12rWFYh0PDw9vKy//2WQYq3qoNi/K8fDw8M7x8s16ctjfO9zqIfHw8PDu4VWHCZKiNv80CVY19KNZCTw8PLwlLy9850vvxT5PMHh4eHj38Kolaa/hW00MvebIm/Xj4eHhHePNwb32a3VAIR87wMPDw9vL6xWyCaY3LNUbFCjMRODh4eGNefkowF5qvpTqcstIPDw8vK28cqt0MByQjyD02hl4eHh4e3m7SuTqEEAvYSR4PDw8vNO8OSbZ9OfFcT6w9dj7t8LDw8Mr/gP/bF35wdWG6dp1WY+Hh4d3mDfZ7vPX699OMNE0GR4eHt6A19vuC5GLBwiqIY5Kfzw8PLwDvGaROh4yKA+etpINHh4e3jle3lbIG7jVzb3XFikceuHh4eEd4OXlcjIOVZ35mjRw3xTZeHh4eF/Aa3aLx6HpNSbw8PDwPsurDgfkpLxQzpsUeHh4eKd5+YBUHoh8658HK6q48fDw8Dbxegdgk1GtarNjElY8PDy8rbwfjf4NAeIKaagAAAAASUVORK5CYII=" class="article-share-link">分享</a><div class="tags"><a href="/tags/node/">node</a><a href="/tags/mongoose/">mongoose</a></div><div class="post-nav"><a href="/2017/05/07/nodejs之path模块/" class="pre">nodejs之path模块</a><a href="/2017/04/18/node核心模块--fs/" class="next">node核心模块--fs</a></div><div id="container"></div><link rel="stylesheet" href="/css/default.css?v=0.0.0"><script src="/js/gitment.browser.js?v=0.0.0"></script><script>var gitment = new Gitment({
  owner: 'xianyulaodi',
  repo: 'myBlogCommentRepo',
  oauth: {
    client_id: 'bb8f1145bdd0717d9830',
    client_secret: 'b18dc8d3b04cea043cb47d083049276cd93e0503',
  },
})
gitment.render('container')
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://xianyulaodi.github.io"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/node/">node</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vue/">vue</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/github/" style="font-size: 15px;">github</a> <a href="/tags/js/" style="font-size: 15px;">js</a> <a href="/tags/高阶函数/" style="font-size: 15px;">高阶函数</a> <a href="/tags/BigPipe/" style="font-size: 15px;">BigPipe</a> <a href="/tags/博客园迁移/" style="font-size: 15px;">博客园迁移</a> <a href="/tags/cookie/" style="font-size: 15px;">cookie</a> <a href="/tags/expess/" style="font-size: 15px;">expess</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/node/" style="font-size: 15px;">node</a> <a href="/tags/path/" style="font-size: 15px;">path</a> <a href="/tags/mongoose/" style="font-size: 15px;">mongoose</a> <a href="/tags/fs/" style="font-size: 15px;">fs</a> <a href="/tags/setTimeout/" style="font-size: 15px;">setTimeout</a> <a href="/tags/Eventloop/" style="font-size: 15px;">Eventloop</a> <a href="/tags/npm/" style="font-size: 15px;">npm</a> <a href="/tags/vue/" style="font-size: 15px;">vue</a> <a href="/tags/vuex/" style="font-size: 15px;">vuex</a> <a href="/tags/vue-router/" style="font-size: 15px;">vue-router</a> <a href="/tags/router/" style="font-size: 15px;">router</a> <a href="/tags/css/" style="font-size: 15px;">css</a> <a href="/tags/正则/" style="font-size: 15px;">正则</a> <a href="/tags/爬虫/" style="font-size: 15px;">爬虫</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/02/25/如何写一个npm包/">如何写一个npm包</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/10/BigPipe小探/">BigPipe小探</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/22/将中文转为拼音首字母/">js提取中文拼音首字母</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/29/给女朋友写的一个简书爬虫/">给女朋友写的一个简书爬虫</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/24/nodejs学习小结/">nodejs学习小结</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/12/express图片上传/">express图片上传</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/19/浅析css中的cursor/">浅析css中的cursor</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/03/javascript高阶函数/">javascript高阶函数</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/18/手写一个router/">手写一个router</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/30/正则表达式学习/">正则表达式学习</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-money"> 请博主喝咖啡</i><img src="/img/WeChatQR.png"/></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.cnblogs.com/xianyulaodi/" title="我的博客园" target="_blank">我的博客园</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">咸鱼老弟.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>