<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>使用vue2+vue-router+vuex写一个cnode的脚手架 | 咸鱼老弟</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">使用vue2+vue-router+vuex写一个cnode的脚手架</h1><a id="logo" href="/.">咸鱼老弟</a><p class="description">【博客园-咸鱼老弟】</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/resource/"><i class="fa fa-university"> 资源</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">使用vue2+vue-router+vuex写一个cnode的脚手架</h1><div class="post-meta">Mar 29, 2017<span> | </span><span class="category"><a href="/categories/vue/">vue</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#项目简介"><span class="toc-number">1.</span> <span class="toc-text">项目简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#运行方式"><span class="toc-number">2.</span> <span class="toc-text">运行方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#项目说明"><span class="toc-number">3.</span> <span class="toc-text">项目说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#vue组件的生命周期"><span class="toc-number">4.</span> <span class="toc-text">vue组件的生命周期</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何写一个组件"><span class="toc-number">5.</span> <span class="toc-text">如何写一个组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#vur-router"><span class="toc-number">6.</span> <span class="toc-text">vur-router</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#vuex2-0"><span class="toc-number">7.</span> <span class="toc-text">vuex2.0</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#这里稍作解释：-个人理解，有误之处，欢迎指出"><span class="toc-number">7.0.1.</span> <span class="toc-text">这里稍作解释：(个人理解，有误之处，欢迎指出)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#这里介绍一下vuex异步的操作"><span class="toc-number">7.1.</span> <span class="toc-text">这里介绍一下vuex异步的操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#页面是如何使用传回来的数据的？"><span class="toc-number">7.2.</span> <span class="toc-text">页面是如何使用传回来的数据的？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#后记"><span class="toc-number">8.</span> <span class="toc-text">后记</span></a></li></ol></div></div><div class="post-content"><p>&ensp;&ensp;公司后面的H5项目打算用vue2来做，之前有用过一小会vue，但没有真正的去了解，之前框架来说用react用的比较多点。所以趁这个阶段，用cnode中文网提供的api来做了个入门的脚手架，如果脚手架搭好并理解了，那么后面的运用就轻松多了。</p>
<a id="more"></a>
<p><strong>本项目github地址</strong> <a href="https://github.com/xianyulaodi/vue-cnode-template" target="_blank" rel="noopener">点击这里</a></p>
<p>&ensp;&ensp;vue目前在中国来说应该是属于最火的一个前端框架吧，当然，对框架还是一样的态度，如果项目中要用，就去研究它，否则，只需要去了解它。因为之前有react的一些项目经验，而且两者有一些共同性，所以vue的入门来说还是相当比较容易的，主要做的是勤查文档。</p>
<p>&ensp;&ensp;由于时间有限，没有对cnode中文网进行完全的重构，只重构了首页和详情页，因为这样比较容易理解，如果整个重构了，对于初学来说，比较难看懂，完成后的界面如图所示:(没怎么搞样式，界面巨丑)</p>
<p><img src="//images2015.cnblogs.com/blog/776370/201703/776370-20170330192330508-241902663.png" alt="首页">首页&ensp;&ensp;<br><img src="//images2015.cnblogs.com/blog/776370/201703/776370-20170330192446461-1898007541.png" alt="详情页">详情页</p>
<h2 id="项目简介"><a href="#项目简介" class="headerlink" title="项目简介"></a>项目简介</h2><p>基于vue.js的前端开发环境，用于前后端开发的单页面应用，可以在开发的时候使用ES2015 、scss等。项目包含：</p>
<ul>
<li>基础库：<code>vue.js</code>、 <code>vue-router2.0版本</code>、<code>vuex</code>、<code>axios</code></li>
<li>编译/打包工具：<code>webpack</code>、<code>babel</code>、<code>node-sass</code></li>
<li>单元测试工具：<code>karma</code>、<code>mocha</code>、<code>sinon-chai</code></li>
<li>本地服务器：<code>express</code></li>
</ul>
<h2 id="运行方式"><a href="#运行方式" class="headerlink" title="运行方式"></a>运行方式</h2><ul>
<li>开发环境</li>
</ul>
<ol>
<li><code>npm install</code> </li>
<li>点击start.sh、或者直接cmd里面输入  <code>npm run dev</code></li>
</ol>
<ul>
<li>配置构建项目，构建好的文件会输出到 “dist” 目录，<br> <code>npm run build</code></li>
<li>服务器，可以查看构建的页面<br>  <code>npm run build-server</code></li>
<li>单元测试<br>  <code>npm run unit</code></li>
</ul>
<h2 id="项目说明"><a href="#项目说明" class="headerlink" title="项目说明"></a>项目说明</h2><p>&ensp;&ensp;之前玩react比较多，因为在新公司有些项目打算用vue，所以打算也来玩玩vue,不过是直接入手vue2,为了怕自己忘记，所以打算来个小小的总结,不过本文是一篇大杂烩，因为要写vue、vue-router和vuex这三者</p>
<h2 id="vue组件的生命周期"><a href="#vue组件的生命周期" class="headerlink" title="vue组件的生命周期"></a>vue组件的生命周期</h2><p>&ensp;&ensp;如果你之前有玩过react，那么就可以拿这些生命周期和react的进行一个类比了。组件的生命周期图如下：<br><img src="//images.cnblogs.com/cnblogs_com/fly_dragon/276813/o_lifecycle-%E6%A0%87%E6%B3%A8%E7%89%88%E6%9C%AC.png" alt="组件生命周期"></p>
<h2 id="如何写一个组件"><a href="#如何写一个组件" class="headerlink" title="如何写一个组件"></a>如何写一个组件</h2><p>&ensp;&ensp;vue的读音和view同音，和react一样，也是组件化的一个理想框架，vue中组件化是如何实现的呢？我们以我们的项目为例</p>
<blockquote>
<p>我们的项目中，首页的列表就有用到组件 indexItem组件,代码如下：component/indexItem.vue</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-list-wrap"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"item-list"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">"item in itemList"</span>&gt;</span></span><br><span class="line">           	    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">:to</span>=<span class="string">"&#123;name:'detail',params:&#123;id:item.id&#125;&#125;"</span> &gt;</span>&#123;&#123; item.title &#125;&#125;<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  props: [<span class="string">'itemList'</span>],</span></span><br><span class="line"><span class="javascript">  mounted: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">"scss"</span> <span class="attr">rel</span>=<span class="string">"stylesheet/scss"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">.item-list-wrap&#123;</span></span><br><span class="line"><span class="undefined">  background: #fff;</span></span><br><span class="line"><span class="undefined">  .item-list li&#123;</span></span><br><span class="line"><span class="undefined">    height: 45px;</span></span><br><span class="line"><span class="undefined">    line-height: 45px;</span></span><br><span class="line"><span class="undefined">    text-align: left;</span></span><br><span class="line"><span class="undefined">    padding:0 10px;</span></span><br><span class="line"><span class="undefined">    font-size: 14px;</span></span><br><span class="line"><span class="undefined">    overflow: hidden;</span></span><br><span class="line"><span class="undefined">    text-overflow: ellipsis;</span></span><br><span class="line"><span class="undefined">    white-space:nowrap;</span></span><br><span class="line"><span class="undefined">    border-bottom: 1px solid #ccc;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;我们定义了一个template模板，template数据名称来源于props，所有我们template使用for循环的时候，用的itemList，因为props里面写的是itemList.<br>那么父组件如何调用这些组件呢，使用方法如下：<br>views/index.vue<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">c-header</span> <span class="attr">:hTitle</span>=<span class="string">"title"</span>&gt;</span><span class="tag">&lt;/<span class="name">c-header</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">index-item</span> <span class="attr">:item-list</span>=<span class="string">'topicsListData'</span>&gt;</span><span class="tag">&lt;/<span class="name">index-item</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> cHeader <span class="keyword">from</span> <span class="string">'components/header'</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> indexItem <span class="keyword">from</span> <span class="string">'components/indexItem'</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="undefined">    data () &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        title: <span class="string">'node中文网'</span>,</span></span><br><span class="line"><span class="undefined">        tabId:0</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="undefined">    computed: mapGetters(&#123;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">      topicsListData :<span class="string">'getTopicsListData'</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    &#125;),</span></span><br><span class="line"><span class="undefined">    methods: &#123;</span></span><br><span class="line"><span class="undefined">     components: &#123;cHeader,indexItem&#125;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>&ensp;&ensp;如上面的代码所示，我们import我们需要的组件，这里有个注意点，调用组件的时候，不支持驼峰命名法，所以你引用的驼峰命名的组件要拆开，比如引入的是indexItem组件，那么在使用的时候要拆成index-item。</p>
<p>&ensp;&ensp;如何传入数据呢。：[组件props的数据命名]，比如我的indexItem组件中，它的props里面的数据名字为 itemList,所以我父组件传值的时候，也是这样，通过<br> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">index-item</span> <span class="attr">:item-list</span>=<span class="string">传入的数据</span>&gt;</span><span class="tag">&lt;/<span class="name">index-item</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>&ensp;&ensp;和引入组件一样，如果组件里面的props的命名是驼峰命名方式的话，也是需要拆开的。这里还有个需要注意点，我们不必在全局注册每个组件。通过使用组件实例选项注册，可以使组件仅在另一个实例/组件的作用域中可用。所以我们的项目中，我们应用了什么组件，在compontents里面就要写上对应的组件名称。如代码<br> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">components: &#123;cHeader,indexItem&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="vur-router"><a href="#vur-router" class="headerlink" title="vur-router"></a>vur-router</h2><ol>
<li>我这边使用的是vue-router2.0版本，遇到了一个坑，就是vue-router跳转之后，再回来，会刷新一次页面。比如我从a页面跳转到b页面，再从b页面返回a页面，那么a页面会刷新一次。这样存在的一个问题就是，我a页面又必须再请求一次数据，或者说，我a页面上传浏览的状态不能够保存。现在还没有找到很好的解决办法，包括使用html5的本地存储也没能很好的解决这个问题。</li>
<li>传参之后，改页面如何获取传过来的参数呢，可以用这个方法，比如我在router中传了一个id到b页面，那么b页面使用的时候可以用下面的代码来获取<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">this.$route.params.id</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>关于vue-router就介绍这些，因为可以看文档或者看代码就可以了解完，难度不是很大</p>
<h2 id="vuex2-0"><a href="#vuex2-0" class="headerlink" title="vuex2.0"></a>vuex2.0</h2><p>&ensp;&ensp;刚开始看了vuex的文档，发觉跟redux很像，因为它确实有参照redux的思想来写，后来在使用过程中，发觉vuex还是跟redux有挺大的不同的。不过两者的一个相同点就是都是属于状态管理器，只有当你的页面有足够多的状态的时候才需要使用，否则没必要用，小项目用vuex之后增加代码的复杂性而已。<br>   <img src="https://vuex.vuejs.org/zh-cn/images/vuex.png" alt="vuex示意图"></p>
<h4 id="这里稍作解释：-个人理解，有误之处，欢迎指出"><a href="#这里稍作解释：-个人理解，有误之处，欢迎指出" class="headerlink" title="这里稍作解释：(个人理解，有误之处，欢迎指出)"></a>这里稍作解释：(个人理解，有误之处，欢迎指出)</h4><ul>
<li>vuex也是跟redux一样，有且只能由一个store</li>
<li>在vuex中，状态的改变只能是通过mutations</li>
<li>用户改变状态有两种方式：第一种是触发action,然后action再来触发mutations;第二种方式是用户直接出发mutations</li>
<li>mutations只能处理同步的状态，而action既能处理同步，也能处理异步,这也是action存在的理由，一般异步的状态管理交给action去做即可，同步的话可以直接触发mutations</li>
<li>触发action用dispatch、触发mutations用commit</li>
</ul>
<h3 id="这里介绍一下vuex异步的操作"><a href="#这里介绍一下vuex异步的操作" class="headerlink" title="这里介绍一下vuex异步的操作"></a>这里介绍一下vuex异步的操作</h3><p>&ensp;&ensp;跟redux一样，理解异步状态管理还是比较难的，不过当你理解了异步的操作，你也就基本掌握vuex了。<br>&ensp;&ensp;假设我有一个异步请求，需要请求后台的数据，那么需要怎么做呢？<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span>;</span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> types <span class="keyword">from</span> <span class="string">'../../constants/constants'</span>;</span><br><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">    topicsList:[]</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> getters = &#123;</span><br><span class="line">    getTopicsListData: <span class="function"><span class="params">state</span> =&gt;</span> state.topicsList</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> actions = &#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @name  获取主页数据</span></span><br><span class="line"><span class="comment">     * 异步的操作交给action,然后将获取到的数据 commit 到 mutations那里去</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * # 注意点：</span></span><br><span class="line"><span class="comment">     * 坑点：vuex2只能有两个参数，所以如果你的第二个参数中有多个参数，可以用对象的形式,实际的项目中貌似通过router中来传的，待定</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    [types.GET_TOPICS](&#123;commit&#125;,obj) &#123;</span><br><span class="line">        axios.get(<span class="string">`https://cnodejs.org/api/v1/topics?page=<span class="subst">$&#123;obj.pageNo&#125;</span>&amp;limit=20&amp;tab=<span class="subst">$&#123;obj.tab&#125;</span>`</span>)</span><br><span class="line">        .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">          commit(types.SET_TOPICS, &#123; <span class="attr">list</span>: response.data.data &#125;)</span><br><span class="line">        &#125;, (err) =&gt; &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(err)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> mutations = &#123;</span><br><span class="line">    <span class="comment">// 获取首页的数据</span></span><br><span class="line">    [types.SET_TOPICS](state,&#123;list&#125;) &#123;</span><br><span class="line">        state.topicsList=list;  <span class="comment">//再次记住，mutations是唯一允许更新应用状态的地方</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span><br><span class="line">    state,</span><br><span class="line">    getters,</span><br><span class="line">    actions,</span><br><span class="line">    mutations</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>&ensp;&ensp;如上面的代码所示，我们通过axios来发送我们的请求，具体的流程如下：</p>
<ol>
<li>我们定义了一个默认的状态topicsList，并赋值为一个空数组</li>
<li>我们定义了一个action来获取后端数据， <code>[types.GET_TOPICS]({commit},obj) {}</code>,其实这里也可以直接用方法名，只是vuex遵循flux的写法。也就是说这里其实也是可以写成<code>getTopics({commit},obj) {}</code>这种形式的。<br>action的方法里，只能由两个参数，一个是默认的commmit,一个是其他参数，所以当你的异步请求有多个参数的时候，需要把它封装到一个对象或者数组里面。</li>
<li>我们在前面定义了一个默认的装填topicsList,前面也说了，状态的改变只能交给mutations来做，所以action获取到的数据，如果要传到topicsList这个状态中，必须要先交给mutations，再由mutations来更新topicsList。所以，获取到后端返回的数据之后，我们commit给mutations，然后mutations再来更新topicsList这个状态</li>
<li>在上面的代码中，我们有看到getters，干嘛用的呢？有一种情况是这样的，比如我渲染一个页面的时候，页面已经渲染完了，但是你的请求数据是异步的，数据还没有回来，那怎么办呢？getters就是这个作用的。我们将mutations更新的状态，传给getters,在getters里面，你可以对这些数据进行一些处理，然后再交给页面使用。</li>
</ol>
<h3 id="页面是如何使用传回来的数据的？"><a href="#页面是如何使用传回来的数据的？" class="headerlink" title="页面是如何使用传回来的数据的？"></a>页面是如何使用传回来的数据的？</h3><p> 在view/index.vue中，我们看下面的代码，代码是被简化的，只展示出有用的部分</p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">index-item</span> <span class="attr">:item-list</span>=<span class="string">'topicsListData'</span>&gt;</span><span class="tag">&lt;/<span class="name">index-item</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123;mapState&#125; <span class="keyword">from</span> <span class="string">'vuex'</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123;mapGetters&#125; <span class="keyword">from</span> <span class="string">'vuex'</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> indexItem <span class="keyword">from</span> <span class="string">'components/indexItem'</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> * <span class="keyword">as</span> types <span class="keyword">from</span> <span class="string">'../constants/constants'</span>;</span></span><br><span class="line"><span class="undefined">  </span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="undefined">    data () &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        title: <span class="string">'node中文网'</span></span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="javascript">    <span class="comment">// computed相当于属性的一个实时计算，里面的数据如果有变化，会自动去更新</span></span></span><br><span class="line"><span class="undefined">    computed: mapGetters(&#123;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">      topicsListData :<span class="string">'getTopicsListData'</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    &#125;),</span></span><br><span class="line"><span class="undefined">    methods: &#123;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">      /*</span></span><br><span class="line"><span class="undefined">      * @获取内容</span></span><br><span class="line"><span class="undefined">      */</span></span><br><span class="line"><span class="undefined">      getTopics (page,tab,index) &#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 触发action</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">this</span>.$store.dispatch(&#123;</span></span><br><span class="line"><span class="undefined">              type:types.GET_TOPICS,</span></span><br><span class="line"><span class="undefined">              pageNo:page,</span></span><br><span class="line"><span class="undefined">              tab:tab</span></span><br><span class="line"><span class="undefined">          &#125;);</span></span><br><span class="line"><span class="javascript">          <span class="keyword">this</span>.tabId=index;</span></span><br><span class="line"><span class="undefined">      &#125;,</span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="undefined">    /*</span></span><br><span class="line"><span class="undefined">    * @初始化(组件挂载完成)，相当于react中的componentWillamount</span></span><br><span class="line"><span class="undefined">    */</span></span><br><span class="line"><span class="undefined">    mounted () &#123;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.getTopics(<span class="number">1</span>,<span class="string">'all'</span>); </span></span><br><span class="line"><span class="undefined">      </span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="undefined">    components: &#123;indexItem&#125;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;我们可以看到，在代码中，我们定义了一个方法 <code>getTopics</code>，它的作用是发送一个action,并传一些参数进去。页面初始化的时候，我们执行这个方法。也就是mounted里面，我们执行了getTopics这个函数。<br>&ensp;&ensp;我们还看到，代码中，我们在computed里面执行了mapGetters，并在里面写入了getters对象，如代码所示：<br>&ensp;&ensp;<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">computed: mapGetters(&#123;</span><br><span class="line">    topicsListData :<span class="string">'getTopicsListData'</span></span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure></p>
<p>&ensp;&ensp;这里稍作解释，computed的作用就是：它相当于一个实时计算，如果里面的内容对应的数据有变化，就会去自动更新里面的数据，并且重新渲染。而mapGetters是映射对应的getters，代码以键值对的形式：  </p>
<p> <code>topicsListData :&#39;getTopicsListData</code>  </p>
<p> &ensp;&ensp;其中指要和getters里面定义的相对应。比如我getter定义的值为getTopicsListData，mapGetters里面对象的值也要写为getTopicsListData。</p>
<p>&ensp;&ensp;而topicsListData则是你需要传到组件中的数据，如下所示  </p>
<p><code>&lt;index-item :item-list=&#39;topicsListData&#39;&gt;&lt;/index-item&gt;</code>;  </p>
<p>在异步获取的数据中，如果要传给组件，只能从gettter这里去拿，不然是获取不到后端返回的数据的。因为有一个先后的问题 </p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><ul>
<li>对于vue2和vue-router2.0以及vuex2的总结就先到这里，主要是自己在第一次使用中遇到的问题。<ul>
<li>后面将进入实战阶段，不过脚手架搭好了，后面的问题就是一直参考文档和埋坑就可以了。</li>
<li>当然，因为对vue2的认识时间不是特别长，所以这篇文章难免有些错误，有误之处，欢迎指出</li>
</ul>
</li>
</ul>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="https://xianyulaodi.github.io/2017/03/29/使用vue2+vue-router+vuex写一个cnode的脚手架/" data-id="cje8p101s0013jkp6uigx9706" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPYAAAD2CAAAAADAeSUUAAADNUlEQVR42u3aS47qUAwFQPa/aVp60+7cd2yDRExlhPgkKTNw/Hk84uP577h6//fR++3Vp+e7On9ndGBjY2PfhP08Hr9vvXexKjK/+tWn5ytiY2Nj72Ofk9aZ+gyO83lelfwSCzY2NvY3s88ppJoI5+E7v8bGxsbGPsPybybUPL0lV8fGxsb+TnZeQvTKgLzMmIwf3tJLw8bGxv54dnXQ+8mv3zjfxsbGxv5I9rN4TJJEb5A8GetengcbGxt7EfsqAUxGv70WT15sTBZ6HvlJsbGxsW/CPn+cN3Ty88zHyVHrP/+fsbGxsW/OzgFJyZGMB5IAVYe+o2YTNjY29s3Z1aRSjehkcScPfXXAjI2Njb2P/b6Vmjz95KVOrwj5z1QEGxsbewW711qqJpJ8hNwrk6J2GDY2NvYiduHxvTWgnTSYXvU3NDtq2NjY2DdhJ4kkila8xFMN2XxJ6I+rYGNjY69m99ZreuzXjgqSwgYbGxt7H7v6ZN5bu5k0sJKr9IKCjY2NvYM9afFMCol86SdJcvloARsbG3sru5dOegVDbyUoT1GFIgQbGxt7HTufCSdNqGog8mWdfJXnMojY2NjYS9n5o3yVUV3HqZ6hOvrFxsbG/gZ2+eG+FcT5neTlUJTAsLGxsW/I7q1IVptE1ferI+TJ8AAbGxt7Ezsf0+ZN/EkDqNrSqrarsLGxsXewe22dfCScD4Ynyala6mBjY2PvY+erM1VYtQlVLUia38fGxsZex64+4k+C1Vvc7K3vjKYi2NjY2Ddh95rpyfC1OkhIQtlb0MHGxsbezc5vcV4SJIltUg7lJRM2Njb2Jna1QV9duBzNmeNz5veJjY2NvY/dKwB6KW1ShFRDH9Ve2NjY2IvY1dZMMi2tJpg8OeUhjiKHjY2NvYL92rFu3pCarGkm72NjY2N/A3uS6norNZNUOkl7zaBgY2Nj34Q9WZGcJKpJSuslNmxsbOzd7NcmrV55kC/c9EoObGxsbOxRNdNqZs2HE9G4FxsbG/vL2MmDfnUpcz66KKc3bGxs7HXs5ER546a6mtkLXz4kvkxg2NjY2CvYvUFvdUxbHcQWiopkGICNjY29k/0DRggwE9ZhcYEAAAAASUVORK5CYII=" class="article-share-link">分享</a><div class="tags"><a href="/tags/vue/">vue</a><a href="/tags/vuex/">vuex</a><a href="/tags/vue-router/">vue-router</a></div><div class="post-nav"><a href="/2017/03/31/git常用命令总结/" class="pre">git常用命令总结</a><a href="/2017/03/22/老生常谈-从输入url到页面展示到底发生了什么/" class="next">老生常谈-从输入url到页面展示到底发生了什么</a></div><div id="container"></div><link rel="stylesheet" href="/css/default.css?v=0.0.0"><script src="/js/gitment.browser.js?v=0.0.0"></script><script>var gitment = new Gitment({
  owner: 'xianyulaodi',
  repo: 'myBlogCommentRepo',
  oauth: {
    client_id: 'bb8f1145bdd0717d9830',
    client_secret: 'b18dc8d3b04cea043cb47d083049276cd93e0503',
  },
})
gitment.render('container')
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://xianyulaodi.github.io"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/node/">node</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vue/">vue</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/github/" style="font-size: 15px;">github</a> <a href="/tags/js/" style="font-size: 15px;">js</a> <a href="/tags/高阶函数/" style="font-size: 15px;">高阶函数</a> <a href="/tags/BigPipe/" style="font-size: 15px;">BigPipe</a> <a href="/tags/博客园迁移/" style="font-size: 15px;">博客园迁移</a> <a href="/tags/cookie/" style="font-size: 15px;">cookie</a> <a href="/tags/expess/" style="font-size: 15px;">expess</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/node/" style="font-size: 15px;">node</a> <a href="/tags/path/" style="font-size: 15px;">path</a> <a href="/tags/mongoose/" style="font-size: 15px;">mongoose</a> <a href="/tags/fs/" style="font-size: 15px;">fs</a> <a href="/tags/setTimeout/" style="font-size: 15px;">setTimeout</a> <a href="/tags/Eventloop/" style="font-size: 15px;">Eventloop</a> <a href="/tags/npm/" style="font-size: 15px;">npm</a> <a href="/tags/vue/" style="font-size: 15px;">vue</a> <a href="/tags/vuex/" style="font-size: 15px;">vuex</a> <a href="/tags/vue-router/" style="font-size: 15px;">vue-router</a> <a href="/tags/router/" style="font-size: 15px;">router</a> <a href="/tags/css/" style="font-size: 15px;">css</a> <a href="/tags/正则/" style="font-size: 15px;">正则</a> <a href="/tags/爬虫/" style="font-size: 15px;">爬虫</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/02/25/如何写一个npm包/">如何写一个npm包</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/10/BigPipe小探/">BigPipe小探</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/22/将中文转为拼音首字母/">js提取中文拼音首字母</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/29/给女朋友写的一个简书爬虫/">给女朋友写的一个简书爬虫</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/24/nodejs学习小结/">nodejs学习小结</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/12/express图片上传/">express图片上传</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/19/浅析css中的cursor/">浅析css中的cursor</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/03/javascript高阶函数/">javascript高阶函数</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/18/手写一个router/">手写一个router</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/30/正则表达式学习/">正则表达式学习</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-money"> 请博主喝咖啡</i><img src="/img/WeChatQR.png"/></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.cnblogs.com/xianyulaodi/" title="我的博客园" target="_blank">我的博客园</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">咸鱼老弟.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>